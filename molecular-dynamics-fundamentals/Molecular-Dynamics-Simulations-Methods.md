# 7. Molecular Dynamics Simulations Methods (Leach)

# Table of Contents

## 7.1. Introduction

- In molecular dynamics, successive configurations of the system are generated by integrating Newton’s laws of motion.
- The result is a trajectory that specifies how the positions and velocities of the particles in the system vary with time.

## 7.3. Molecular Dynamics with Continuous Potentials

- in more realistic models of intermolecular interactions,
    - force on each particle will change whenever particle changes its position or
    - whenever other particle it interact with changes position.
- Continuous potential and motions of all particles are coupled together → many body problem that can’t be solved analytically.
    - **many body problem** — microscopic system with many interacting particles.
    - equations of motions are integrated using *finite difference methods*.

### 7.3.1. Finite Difference Methods.

- **Finite difference techniques** are used to generate MD trajectories with continuous potential models, assume to be pairwise additive.
    - The idea is that integration is broken down into many small stages
    - each separate in time, fixed time.
    - toptal force at time t is calculated as the vector sum of its interactions with other particles.
    - From force, we can determine acceleration of particles, combined with the positions and velocities at time t
    - force is constant during time step.

- Many algorithms for integrating the equations of motion using finite difference
    - all assume that the positions and dynamic properties (velocities, accelerations, etc.) can be approx. by Taylor series expansion:
        
$$
r(t+\delta t)= r(t)+\delta tv(t) +\frac{1}{2}\delta t^2a(t)+\frac{1}{6}\delta t^3b(t)+\frac{1}{24}\delta t^4 c(t)+... \tag{7.2}
$$

$$
v(t+\delta t)= v(t)+\delta ta(t) +\frac{1}{2}\delta t^2b(t)+\frac{1}{6}\delta t^3c(t)+... \tag{7.3}
$$

$$
a(t+\delta t)= a(t)+\delta tb(t) +\frac{1}{2}\delta t^2c(t)+... \tag{7.4}
$$

$$
b(t+\delta t)= b(t)+\delta tc(t) +... \tag{7.5}
$$
        
   - a is acceleration and b is third derivative.

- **Verlet algorithm** is probably the most widely used method for integrating the equations of motion in molecular dynamics simulation
    - uses the positions and accelerations at time t, and the positions from the previous step, $r(t=\delta t)$, to calculate the new positions at time t
    
$$
r(t+\delta t)= r(t)+\delta tv(t) +\frac{1}{2}\delta t^2a(t)+... \ \text{new position} \tag{7.6}
$$

$$
r(t-\delta t)= r(t)-\delta tv(t) +\frac{1}{2}\delta t^2a(t)-...  \ \text{position from previous step}\tag{7.6}
$$

Adding them together:

$$
r(t+\delta t)= 2r(t)- r(t-\delta t) +\delta t^2a(t)  \tag{7.8}
$$

velocity:

$$
v(t)=[r(t+\delta t)-r(t-\delta t)]/2\delta t \tag{7.9}
$$
    
- Implementation of Verlet is straightforward and storage requirements are modest.
    - Storage requirement comprise of two set of positions $(r(t) \ \text{and} \ r(t-\delta t)) \ \text{and the accelerations } a(t)$ .
    - The drawback is that the position $$r(t+\delta t)$$ are obtained by adding small term $(\delta t^2a(t))$ to the different of two much larger therms $2r(t) \ \text{and} \ r(t-\delta t)$.
        - This can lead to loss of precision.
    - Other limitations
        - lack of explicit velocity term → difficult to obtain velocities and would not be available until next position is calculated.
        - not a self starting algorithm
            - new positions are calculated from current position, and position from previous time step, $r(t-\delta t)$.
- Variations of Verlet algorithm — *leap-frog algorithm*
    - two advantage over the standard Verlet algorithm: explicit includes the velocity and also does not require calculation of the differences of large numbers.
    - disadvantage: positions and velocities are not synchronised.
- ***velocity Verlet* method** — gives positions, velocities, and accelerations at the same time and does not compromise precision:
    - used in NAMD
        
        $$
        r(t+\delta t)= r(t)+\delta tv(t) +\frac{1}{2}\delta t^2a(t) \tag{7.14}
        $$
        
    
    $$
    v(t+\delta t)=v(t)+\frac{1}{2}\delta t [a(t)+a(t+\delta t)] \tag{7.15}
    $$
    
    - 3-stage procedure because in 7.15, new velocities requires acceleration at both $t \ \text{and} \ t+\delta t$
    - First step, position at $t+\delta t$ is calculated from 7.14.
    - Velocity at half step is determined using:
    
    $$
    v(t+\frac{1}{2}\delta t)=v(t)+\frac{1}{2}\delta ta(t) \tag{7.16}
    $$
    
    - New forces are next computed from current positions, thus giving $a(t+\delta t).$
    - In the final step, the velocities at time $t+\delta t$ are determined using
    
    $$
    v(t+\delta t)= v(t+\frac{1}{2}\delta t)+\frac{1}{2}\delta t a (t+\delta t) \tag{7.17}
    $$
    

### 7.3.3. Which Integration Algorithm is Most Appropriate?

- Some considerations to decide which is most appropriate integration algorithm to use
    - Computational resources (if use more than one force evaluation per iteration, then can permit for longer timesteps).
    - Rms fluctuation is good indication
- ↑ TS → ↑ RMS energy fluctuation
- Different algorithms may vary in the rate at which the error varies with time step.
    - short time steps for predictor corrector methods may be more accurate but longer time steps, Verlet algorithm may be better.
- memory; synchronization of positions and velocities; whether they are self-starting are all factors that is important in choosing an integration algorithm.

### 7.3.4. Choosing the Time Step

- No hard and fast rule for calculating the most appropriate time step to use in a MD simulation

- too small and trajectory will cover only a limited proportion of the phase space
    - require more computer time for a given length of calculation
    - atomic fluid time step should be small compared to mean time between collisions.

- too large and instabilities may arise in the integration algorithm due to high energy overlaps between atoms.
    - atoms move most quickly and take the largest step (near energy minimum) when it is best to take smallest steps.
    - if too large, system will ‘blow up’ (fig. 7.6)
    

| System | Types of motion present | Suggested time step (s) |
| --- | --- | --- |
| Atoms | Translation | E-14 |
| Rigid molecules | Translation and rotation | 5E-15 |
| Flexible molecules, rigid bonds | Translation, rotation, torsion | 2E-15 |
| Flexible molecules, flexible bonds | Translation, rotation, torsion, vibration | E-15 or 5E-16 |

*Table 7.1 The different types of motion present in various systems together with suggested time steps.*

- Requirement that TS is 1 order magnitude smaller than the shortest motion is a severe restriction.
    - especially if the small motions are of little interest and minimal effect on the overall behavior of the system.
    - A solution is to ‘freeze out’ such vibration
        - by constraining appropriate bonds to their equilibrium values while still permitting the rest of the degrees of freedom to vary under intramolecular and intermolecular forces present.
        - this will enable larger TS

### 7.3.5. Multiple Time Step Dynamics

- obviously desire to explore as much of the phase space as possible but this may be compromised by the need for a small time step.
    - One approach is to use a *multiple time step method.*
        - Certain interactions evolve more rapidly with time than other interactions
- twin-range method is a crude type of multiple time step approach.
    - super erroneous.
- More sophisticated way is to approximate the forces due to these atoms using Taylor series expansion.
- 
- r-RESPA — ‘reversible reference system propagation’ algorithm method
    - forces within a system are classified into a number of groups according to how rapidly the force varies over time.
    - each group has its own time step while maintaining accuracy and numerical stability.
    
    $$
    \Gamma(t)=e^iLt\Gamma~(t=0) \tag{7.31}
    $$
    
- *Liouville* operator, L in the case of molecular system containing *N* atoms (and so *3N* coordinate)

## 7.4. Setting Up and Running a Molecular Dynamics Simulation

1. establish initial configuration of the system. 
    1. initial configuration may be obtained from experimental data. 
2. Assign initial velocities to the atoms
    1. by randomly selecting from Maxwell-Boltzmann distribution at the temperature of interest:
        1. initial velocities are adjusted so that the total momentum of the system is zero. 
        2. 
        3. Having set up the initial velocity, the simulation commences. 
    
    $$
    p(v_{ix})=\left(\frac{m_i}{2\pi k_BT}\right)^{1/2}\exp \left[ \frac{1}{2} \frac{m_iv_{ix}^2}{k_BT}\right] \tag{7.35}
    $$
    
3. The force on each atoms is calculated by differentiating the potential function at each step. 
    1. force on an atom may include contributions from various terms in the force field such as bonds, angles, torsional terms, and non-bonded interactions
4. First stage of molecular dynamics simulation is the equilibration phase
    1. bring the system to equilibrium from starting config. 
    2. various parameters are monitored. 
5. When a stable value is achieve, then production starts. 
    1. Which is when the thermodynamic properties and other data are calculated. 
    2. Parameters to access if equilibrium has been reach depend to some extent of kinetic, potential, and total energies, velocities, temperature, and pressure. 
        1. kinetic and potential can fluctuate, total is constant.

### 7.4.1. Calculating the temperature

1. Many thermodynamic properties can be calculated from molecular dynamics simulations 

## 7.5. Constraint Dynamics

- Why constraints?
    - when simulation involves conformationally flexible molecules, motion is describe in terms of cartesian coordinates
    - complex superposition of different motions.
    - highest frequency motion (e.g. bond vibrations) are less of an interest than lower frequency modes (major conformational changes.
    - However, timestep is dictated by the highest frequency motion in the system
    - So to ↑ timestep of the system without ↓ accuracy, we make specified coordinates to be constrained, or ‘fixed’ during the simulation without affecting the other internal degrees of freedom.

**Constraints**

- constraint is a requirement that the system is forced to satisfy.
    - in constraint dynamics, bonds or angles are forced to adopt specific values throughout the simulation.
    - constrained degrees of freedom do not have energies associated

Restraints

- Restraint ‘encourages’ a particular value.
    - bonds and angle can deviant from the desired value and a penalty is impose for deviation from the reference value.
    - restrained degrees of freedom have energy $k_BT/2$ associated
- Most common method for apply constraints in MD is SHAKE.
- equations of motions are solved while simultaneously satisfying the imposed constraints.
- Constraints are categorized as holonomic or non-holonomic
- Holonomic constraints can be expressed in the form:

$$
f(q_1,q_2,q_3,...,t)=0 \ \ \text{(holonomic)} \tag{7.42}
$$

- Holonomic — the motion of a particle is constrained to lie on the surface of a sphere.
- Non-holonomic — if the particle is able to fall off the sphere under the influence of gravity.
- SHAKE uses holonomic constraints.
    - coordinates of the particles are not independent and the equations of motion in each of the coordinate directions are connected.
    - magnitude of the constraint forces is unknown.
    - As in the case of the box in the slope, the constraint force is perpendicular to the motion of the box. If there is no perpendicular to the surface of the slope, the constraint force does no work.
- Constraint force can be introduced into Newton’s equations as a Lagrange multiplier.

$$
M\frac{d^2x}{dt^2}=\lambda m
$$

- Lagrange multiplier can be used to find the stationary points of functions, subject to a set of constraints.
- constrained degrees of freedom should only be weakly coupled to the remaining degrees of freedom, so that the motion of molecule is not affected by the application of the constraints.
    - not affecting torsional angles.
- By default, NAMD constrains water using the SETTLE algorithm (non-iterative and faster) and constrains the bonds to the other hydrogens using SHAKE (iterative).
- The most common use of SHAKE is for constraining bonds involving hydrogen atoms due to their much higher vibrational frequencies.
    - This allows MD simulation to increase TS from 1 to 2fs.

## 7.7. Molecular Dynamics at Constant Temperature and Pressure

- NVE (or NVEP) ensemble — traditionally performed for MD simulations
    - strictly possible in the limit of infinite system size (’the thermodynamic limit’
    - so always desired to perform simulation in different ensemble
- most popular are the NVT and NPT ensembles.

### 7.7.1. Constant Temperature Dynamics

- Constant temperature simulation may be required if we wish to determine how the behavior of the system changes with temperature
    - unfolding of a protein
    - glass formation
    - simulated annealing algorithms — used in searching conformational space and in the elucidation of macromolecular structure from NMR and X-ray data.
- Temperature is related to time average of the kinetic energy, for unconstrained system, it is:

$$
\langle {\mathscr{K}}\rangle_{NVT}=\frac{3}{2}Nk_BT \tag{7.95}
$$

- To alter the temperature of the system, just scale the velocity.

## 7.8. Incorporating Solvent Effects into Molecular Dynamics: Potentials of Mean Force and Stochastic Dynamics

- In many simulations of solute-solvent systems, the primary focus is the behavior of the solute
- The solvent is of little interest, esp regions far away from solute molecules.
- The use of non-rectangular PBC, stochastic boundaries, and ‘solvent shells’ can reduce # of solvent molecules required and put efficient time into simulating solute.
- In here, we will explore a group of techniques that incorporate the effects of solvent without any explicit specific solvent molecules to be present.

<aside>
🔮 **Potential of mean force (PMF)** — describes how the free energy changes as a particular coordinate is varied.

- such as, separation of two atoms or torsion angle of a bond is varied.
- free energy change described by PMF includes averaged effects of the solvent.
- may be determined by MD or MC using umbrella sampling or free energy perturbation.
- enables modulating effects of the solvent to be taken into account
</aside>
